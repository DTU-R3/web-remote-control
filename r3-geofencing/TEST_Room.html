<!DOCTYPE html>
<head>
    <meta name="viewport" id="vp" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width" />
    <meta charset="utf-8" />

    <link rel="stylesheet" href="https://api.mazemap.com/js/v2.0.9/mazemap.min.css">
    <script type='text/javascript' src='https://api.mazemap.com/js/v2.0.9/mazemap.min.js'></script>


    <!-- https://stackoverflow.com/questions/8238407/how-to-parse-excel-file-in-javascript-html5 -->
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>

    <style>
        body { margin:0px; padding:0px; width: 100vw; height:100vh; font-family: "Helvetica Neue",Helvetica,Arial,sans-serif; font-size: 14px; line-height: 1.42857143; }
        hr { border: 0; height: 1px; background-color: rgb(216, 216, 216); }
    </style>
</head>
<body>
    <div id="map" class="mazemap"></div>
    <div id="controls" class="mapboxgl-ctrl-group">
    </div>


    <script>

		var POI_ID_LIST = [402323, 402324, 402327];

	
			var featuresArray2 = [];
			Mazemap.Data.getPoi(POI_ID_LIST[0]).then(poipoi => {featuresArray2.push(poipoi);});
			Mazemap.Data.getPoi(POI_ID_LIST[1]).then(poipoi => {featuresArray2.push(poipoi);});
			Mazemap.Data.getPoi(POI_ID_LIST[2]).then(poipoi => {featuresArray2.push(poipoi);});
		
		
		
        // Just the same way to initialize as always...
        var myMap = new Mazemap.Map({
            container: 'map',
            campuses: 49,
            center: {lng: 17.629396524328058, lat: 59.857611651927755},
            zoom: 18,
            zLevel: 1,
            scrollZoom: true,
            doubleClickZoom: false,
            touchZoomRotate: false
        });

        myMap.on('load', function(){

            // Add a layer for putting room json data with custom coloring
            addCustomLayer();

            // Read excel file and draw the rooms
			console.log('featurearray2',featuresArray2); 
            drawFeatures(featuresArray2);


        });



        function addCustomLayer(){
            // Add a source layer to use with the layer for rendering geojson features
            myMap.addSource('geojsonPOIs', {type: 'geojson', data: {type: 'FeatureCollection', features: [] } });

            myMap.addLayer({
                id: "geojsonPOIs",
                type: "fill",
                source: "geojsonPOIs",
                paint: {
                    "fill-color": "green",
                    "fill-opacity": 0.3
                },
                filter: ['==', 'zLevel', 1]
            });

            myMap.on('zlevel', () => {
                myMap.setFilter("geojsonPOIs", ['==', 'zLevel', myMap.getZLevel()]);
            });
        }



        // Take an array of maemap features and draw them on the map
        function drawFeatures( featuresArray ){		
            myMap.getSource("geojsonPOIs").setData( {type: "FeatureCollection", features: featuresArray});
        }

 
    </script>

</body>